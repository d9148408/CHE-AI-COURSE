# Unit20｜設備剩餘壽命（RUL）與預知保養：把模型接進維護決策

> 本單元內容主要由舊版 `Part_4/old/Unit15_RUL_Prediction.*` 與 `Part_4/old/Unit15A_NASA_Turbofan_RUL.ipynb` 搬移重整：本檔偏重概念、指標與經濟/決策；Notebook 偏重資料處理與可重現的 baseline。

## 1. 預知保養（PdM）為什麼是化工/石化的高價值題目？

### 1.1 化工產業的設備維護挑戰

在石化與化工產業中，關鍵旋轉設備的可靠度直接影響生產連續性與人員安全。根據 ARC Advisory Group 的研究報告，非計畫性停機每小時的損失在：
- **煉油廠**：約 $50,000 - $250,000 USD
- **乙烯裂解廠**：約 $100,000 - $500,000 USD
- **聚合物工廠**：約 $30,000 - $150,000 USD

關鍵設備包括：
- **離心壓縮機 (Centrifugal Compressor)**：乙烯製程、天然氣處理
- **往復式壓縮機 (Reciprocating Compressor)**：高壓聚乙烯 (LDPE) 製程
- **多段式離心泵浦 (Multistage Pump)**：鍋爐給水、管線輸送
- **攪拌機 (Agitator)**：聚合反應器、結晶器
- **離心機 (Centrifuge)**：固液分離、產品純化

### 1.2 設備失效的連鎖影響

關鍵設備停機不僅影響：
- **直接損失**：生產中斷、產品報廢、緊急維修成本
- **連鎖工安風險**：緊急洩壓、火炬系統超載、製程緊急停車可能引發的安全事件
- **長期影響**：客戶信任度下降、合約違約金、市場佔有率流失

**實例**：1999 年台塑六輕烯烴一廠裂解爐壓縮機軸承突然失效，導致整廠停機 72 小時，損失估計超過 $15M USD。

---

## 2. 維護策略與 P-F 曲線（你要能把模型放進這張圖）

### 2.1 維護策略的演進

維護策略的演進反映了我們對設備可靠度掌握能力的提升：

1.  **事後維修 (Reactive Maintenance, RM)**：
    -   策略：「壞了再修 (Run-to-Failure)」。
    -   成本結構：維修費用 + 停機損失 + 緊急採購零件溢價 + 加班人力 = 通常為計畫性維修的 **3-5 倍**。
    -   缺點：非計畫性停機成本極高，可能引發連鎖工安事故。
    
2.  **預防保養 (Preventive Maintenance, PM)**：
    -   策略：基於時間 (Time-based) 或運轉小時 (Operation Hours)，定期更換零件。
    -   實例：每運轉 8,000 小時更換壓縮機軸承，無論其實際狀態如何。
    -   缺點：
        - **過度保養**：約 30-40% 的零件在更換時仍有 50% 以上剩餘壽命（資料來源：DOE-NASA）。
        - **保養不足**：仍有 15-20% 的隨機故障發生在保養週期內（浴缸曲線的隨機失效期）。
        
3.  **預知保養 (Predictive Maintenance, PdM)**：
    -   策略：基於狀態 (Condition-Based Monitoring, CBM)，利用感測器數據監控設備健康，預測 **剩餘壽命 (Remaining Useful Life, RUL)**。
    -   技術：振動分析、熱像檢測、油液分析、超音波檢測、聲射檢測 (AE)。
    -   優點：
        - 降低維修成本 **25-30%**（McKinsey & Company, 2021）
        - 減少停機時間 **35-45%**
        - 延長設備壽命 **20-40%**
        - 實現 Just-in-Time 維修，最大化資產價值並確保安全

### 2.2 P-F 曲線 (P-F Curve) 與化工設備失效模式

P-F 曲線描述了設備性能隨時間衰退的過程，是 PdM 的理論基礎。

P-F 曲線中的關鍵概念：
- **P 點 (Potential Failure)**：潛在故障點。感測器開始偵測到異常徵兆，但設備仍能執行功能。
- **F 點 (Functional Failure)**：功能失效點。設備無法達到設計要求的性能，或完全停機。
- **P-F interval**：從偵測到潛在故障到完全失效的時間窗口，這是你能提前規劃維修的時間。
- **RUL (Remaining Useful Life)**：在任意時間點 $t$，距離 $F$ 點的剩餘時間：
    $$ RUL(t) = t_{failure} - t $$

#### 化工設備的典型失效模式與 P-F 特徵

| 失效模式 | 設備範例 | P 點徵兆 | P-F 間隔 | 監測技術 |
|---------|---------|---------|---------|---------|
| **滾動軸承疲勞** | 壓縮機、泵浦 | 高頻振動能量上升 (>10 kHz) | 2-6 週 | 振動分析 (FFT) |
| **葉輪不平衡** | 離心壓縮機 | 1X 轉速振動增加 | 1-3 週 | 振動位移 + 相位 |
| **機械密封失效** | 化學泵浦 | 洩漏率微增、軸承箱溫度上升 | 1-4 週 | 超音波洩漏檢測 |
| **齒輪箱磨損** | 攪拌機減速機 | 邊頻帶 (Sideband) 出現 | 3-8 週 | 油液中金屬顆粒分析 |
| **葉片結垢/腐蝕** | 壓縮機葉輪 | 效率緩慢下降、振動型態改變 | 2-6 個月 | 性能曲線偏移 |
| **電機定子絕緣老化** | 高壓馬達 | 局部放電 (PD) 訊號增加 | 6-18 個月 | 離線 PD 測試 |

我們的目標是利用 AI 模型，在 P 點出現後儘早、準確地估計 RUL，並提供足夠的提前時間 (Lead Time) 來規劃維修活動（零件採購、人力調度、製程降載）。

RUL 的價值不是「數字準」，而是：
> 讓你能在 P-F interval 內做出「降載/備援/排程/備料」的決策。

---

## 3. 指標與交付：你不能只報 RMSE

### 3.1 工程上常用的交付方式

工程上常用的交付方式：
- **RMSE / MAE**：模型誤差
- **分段誤差**：早期/後期（接近失效時）準不準？
- **風險取捨**：高估 RUL（可能漏風險）vs 低估 RUL（可能過度維護）

> 你應該把「誤差」翻譯成「成本」：停機損失、備品成本、維護人力、降載損失。

### 3.2 模型效能指標 (Performance Metrics)

除了視覺化檢查，我們還需要定量指標來評估模型：

#### (1) 均方根誤差 (RMSE)
$$ RMSE = \sqrt{\frac{1}{N}\sum_{i=1}^{N}(RUL_{pred,i} - RUL_{true,i})^2} $$

**物理意義**：預測值與真實值的「平均偏差」，單位為小時。

**業界基準**（基於 NASA C-MAPSS 資料集競賽結果）：
- 優秀：RMSE < 12 小時
- 良好：RMSE = 12-20 小時
- 可接受：RMSE = 20-30 小時
- 不可用：RMSE > 30 小時

#### (2) 平均絕對誤差 (MAE)
$$ MAE = \frac{1}{N}\sum_{i=1}^{N}|RUL_{pred,i} - RUL_{true,i}| $$

**優點**：對離群值不敏感（RMSE 會放大大誤差的影響）。

#### (3) 不對稱評分函數 (Asymmetric Scoring Function)

在 PdM 領域，「低估 RUL」(預測 10 小時，實際 30 小時) 和「高估 RUL」(預測 30 小時，實際 10 小時) 的代價不同。

NASA 提出的評分函數：
$$
s_i = \begin{cases}
e^{-\frac{d_i}{13}} - 1 & \text{if } d_i < 0 \text{ (早預測)} \\
e^{\frac{d_i}{10}} - 1 & \text{if } d_i \geq 0 \text{ (晚預測)}
\end{cases}
$$
其中 $d_i = RUL_{pred,i} - RUL_{true,i}$（預測誤差）。

**解讀**：
- 晚預測（高估 RUL）的懲罰指數增長（$e^{d/10}$），因為可能導致非預期停機。
- 早預測（低估 RUL）的懲罰線性增長（$e^{-d/13}$），代價較小，僅造成「保守維修」。

**目標**：總分 $S = \sum s_i$ 越低越好。

### 3.3 經濟效益分析 (Economic Analysis)

#### 維修策略成本比較

假設一台乙烯裂解廠的高壓壓縮機，我們比較三種維修策略的成本：

**情境設定**
- **設備價值**：$2,000,000 USD
- **軸承組成本**：$50,000 USD
- **計畫性維修人力**：$10,000 USD (3 天，正常班)
- **緊急維修人力**：$30,000 USD (加班 + 外包專家)
- **非預期停機損失**：$200,000 USD/天
- **計畫性停機損失**：$50,000 USD/天 (事先調配產能)
- **年運轉時數**：8,000 小時
- **軸承實際壽命分布**：平均 12,000 小時，標準差 2,000 小時

**策略 A：事後維修 (Reactive Maintenance)**
- **觸發條件**：設備完全故障後才維修。
- **年故障次數**：8,000 / 12,000 ≈ 0.67 次
- **單次成本**：
  - 軸承：$50,000
  - 緊急維修：$30,000
  - 停機 5 天（含故障診斷）：$200,000 × 5 = $1,000,000
  - 次級損害（如聯軸器磨損）：$20,000
  - **小計**：$1,100,000
- **年成本**：$1,100,000 × 0.67 = **$737,000**

**策略 B：預防保養 (Preventive Maintenance)**
- **觸發條件**：每 8,000 小時（1 年）定期更換軸承。
- **年維修次數**：1 次
- **單次成本**：
  - 軸承：$50,000
  - 計畫性維修：$10,000
  - 停機 3 天：$50,000 × 3 = $150,000
  - **小計**：$210,000
- **過度保養損失**：
  - 假設 40% 的軸承還剩 50% 壽命就被更換 → 浪費 $50,000 × 0.4 × 0.5 = $10,000
- **隨機故障風險**：
  - 仍有 15% 機率在週期內故障 → $1,100,000 × 0.15 = $165,000
- **年成本**：$210,000 + $10,000 + $165,000 = **$385,000**

**策略 C：預知保養 (Predictive Maintenance with AI)**
- **觸發條件**：RUL 預測 < 20 小時時安排維修。
- **系統成本**：
  - 振動感測器安裝：$20,000 (一次性)
  - 雲端運算 + 模型維護：$5,000/年
- **年維修次數**：0.67 次（與實際故障頻率一致，但改為計畫性）
- **單次成本**：
  - 軸承：$50,000
  - 計畫性維修：$10,000
  - 停機 3 天：$50,000 × 3 = $150,000
  - **小計**：$210,000
- **預測誤差風險**：
  - 假設 5% 機率誤判（晚預測）導致非預期停機 → $1,100,000 × 0.05 = $55,000
- **年成本**：$210,000 × 0.67 + $5,000 + $55,000 = **$201,000**

#### ROI (Return on Investment) 計算

相較於預防保養 (策略 B)：
- **年節省成本**：$385,000 - $201,000 = $184,000
- **初期投資**：$20,000 (感測器)
- **投資回收期**：$20,000 / $184,000 = **0.11 年 ≈ 1.3 個月**

相較於事後維修 (策略 A)：
- **年節省成本**：$737,000 - $201,000 = $536,000
- **ROI**：($536,000 - $20,000) / $20,000 = **2,580%**

#### 敏感度分析 (Sensitivity Analysis)

| 參數變化 | 策略 C 年成本變化 | 影響程度 |
|---------|-----------------|---------|
| 停機損失 +50% ($75k/天) | +$50k (+25%) | **高** |
| AI 預測誤差率 5% → 15% | +$110k (+55%) | **極高** |
| 軸承壽命標準差 ±50% | ±$15k (±7%) | 中 |
| 感測器維護成本 +100% | +$5k (+2.5%) | 低 |

**結論**：提升 AI 預測精度（降低誤判率）是最關鍵的價值驅動因素。

---

## 4. 工業落地補強：不確定度（區間）與風險決策

RUL 的上線價值通常來自「決策」，而不是單點預測：
- 你更想知道：**最保守情境下還剩多少時間？**（risk-aware）
- 近失效段的高估通常更危險：你要用 **不對稱成本** 去設計評估/門檻

建議在課堂補上：
- **Prediction interval（例如 10%–90% 分位數）** 或 MC Dropout 的不確定度
- **成本函數**：高估 vs 低估的代價不同（用來選模型/選門檻）

---

## 5. 必考觀念：避免群組洩漏（按機組/設備切分）

RUL 最常見的洩漏不是時間，而是：
- 同一台設備的不同 cycle 同時出現在 train/test → 模型只是記住那台設備的軌跡

因此評估時要強制：
- **unit holdout**：按 engine/unit 分割（你在 Notebook 已採用）
- 並在交付物上寫清楚：上線時你面對的是「新設備」還是「同設備的未來」

---

## 6. 實戰演練：`Part_4/Unit20_RUL_Predictive_Maintenance.ipynb`

Notebook 會用 NASA Turbofan（本倉庫已包含 `Jupyter_Scripts/NASA_Turbofan_Data/`）示範：
- 基本資料清理、RUL 標籤（piecewise RUL）與滑動視窗特徵
- strong baseline（樹模型/MLP）+ 交付圖表（每台引擎 RUL 曲線）
- （選讀）若環境有 TensorFlow，提供序列模型骨架（RNN/LSTM）

**最低交付物**
- 1 張圖：RUL 真值 vs 預測（至少挑幾台引擎）
- 1 段決策建議：以你的工廠為例，RUL < X 天要啟動哪些流程？（備料/排程/降載/備援）

**建議追加交付物**
- 1 份「保守策略」：用 RUL 區間下界（或 safety factor）做維護觸發門檻
- 1 張「成本曲線」：不同門檻下的總成本（過度維護 vs 失效風險）
