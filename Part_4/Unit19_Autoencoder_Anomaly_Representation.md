# Unit19｜表示學習（Autoencoder）做異常偵測：不只抓點，還要能「維護」

> 本單元補上深度學習在製程監控常見的路線：用 Autoencoder 學「正常關聯」，再用重建誤差做告警。你會把 Part 3 的 MSPC（PCA/T²/SPE）觀念延伸到更彈性的非線性模型。

## 1. 工業情境：你想抓到「關聯破壞」與「慢慢漂移」

很多異常不是單一變數超限，而是：
- 變數之間的關聯改變（設備/反應機制變了）
- 感測器慢慢飄（零點漂移、污染、老化）

這時候「只看單變數門檻」會漏掉很多真正危險的事件。

---

## 2. Autoencoder 的直覺：把「正常資料」壓縮再還原

Autoencoder 做兩件事：
- Encoder：把高維感測器向量壓縮到低維表示（latent）
- Decoder：從 latent 還原回原始向量

若只用正常資料訓練：
- 正常點 → 還原得好（重建誤差小）
- 異常點 → 還原不好（重建誤差大）

> 工程上你要特別注意：Autoencoder 不是萬能，門檻/告警抑制/漂移辨識才是落地關鍵。

---

## 3. 實務 guardrails（不做會翻車）

- **訓練資料要乾淨**：盡量只用「正常穩態」做基準
- **門檻要可維護**：用分位數（例如 99%）+ 連續 N 次觸發
- **先做 MSPC baseline**：PCA/MSPC 很常更穩、更好維護；AE 是加分不是必須
- **漂移要分清楚**：輸入 OOD（感測器/原料變了）vs 真異常（關聯破壞）

---

## 4. 實戰演練：`Part_4/Unit19_Autoencoder_Anomaly_Representation.ipynb`

Notebook 會：
- 用合成多變數訊號示範（正常 → 漂移 → 關聯破壞）
- 用 `scikit-learn` 的 MLP（可視為簡化版 AE）訓練重建模型
- 對照 PCA 重建誤差（MSPC 觀念延伸）
- 產出重建誤差管制圖 + 連續 N 告警示範

**最低交付物**
- 1 張重建誤差管制圖（含門檻與告警區段）
- 1 段 SOP：告警後怎麼做（確認 → 排除感測器 → 降載/切換 → 事件回顧）

---

## 5. 工程落地補強：哪個感測器在「拉高誤差」？（可排障）

只給一條重建誤差曲線，現場通常會問：
> 「到底是哪個 tag 出問題？我要先查哪支儀表？」

因此建議在課堂補上「誤差分解」：
- 每個變數的重建誤差（$e_i^2$）做排名 → 形成排障清單
- 連續 N 次告警時，輸出 top-K tags（像是 SOP 的第一步）

---

## 6. 建議的告警 SOP（最小可用版）

你可以用以下最小 SOP 做作業交付：
1. **確認告警**：連續 N 次超門檻？是否同時觸發輸入 OOD？
2. **排除儀表**：top-K tags 是否集中在少數儀表？有無校正/更換/清洗紀錄？
3. **判斷機制異常**：若多個 tag 同時失配，是否代表關聯破壞（設備/反應/結垢）？
4. **處置**：降載/切換/停機檢查（依風險等級）
5. **事件回顧**：把本次事件樣本納入回標與重訓資料（可追溯）
